name : CI_release

on:
    release:
        types: [released]
    workflow_dispatch:

env: 
    AZURE_RG_NAME: ${{ vars.PROJECT_NAME }}-rg-${{ vars.AZURE_RESOURCE_IDENTIFIER }}



jobs:
    build_backend:
        runs-on: ubuntu-latest
        environment: production

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4
            - name: Build the app
              run: dotnet build -c Release --property:PublishDir=publish # Publish the app to the publish folder of the API project
              working-directory: ./backend # specify where to find the solution file
            - name: Upload Artifact
              uses: actions/upload-artifact@v4
              with:
                name: backend-artifact
                path: ./backend/ParkNDeploy.Api/publish

    build_frontend:
        runs-on: ubuntu-latest

        steps:
        - name: Checkout repository
          uses: actions/checkout@v4

        - name: Build the app
          run: npm install && npm run build
          working-directory: ./frontend

        - name: Upload Artifact
          uses: actions/upload-artifact@v4
          with:
                name: frontend-artifact
                path: ./frontend/dist
